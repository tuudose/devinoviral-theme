<div class="section" style="padding-top: 120px;">
  <div class="packages-container">
    <div class="section-header">
      <h1>{{ product.title }}</h1>
      <p>{{ product.description }}</p>
    </div>

    {% if product.variants.size > 1 %}
    <form action="/cart/add" method="post" id="product-form">
      <div style="max-width: 500px; margin: 40px auto;">
        <div class="form-group">
          <label for="variant-select">Alege pachetul:</label>
          <select name="id" id="variant-select" class="form-select">
            {% for variant in product.variants %}
              <option value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}selected{% endif %}>
                {{ variant.title }} â€” {{ variant.price | money }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="ig-link">Link Cont sau Postare Instagram:</label>
          <input type="text" id="ig-link" name="properties[Link Instagram]" placeholder="https://instagram.com/username" required class="form-input">
        </div>

        <div class="form-disclaimer">
          âš ï¸ AsigurÄƒ-te cÄƒ profilul este <strong>public</strong>! Altfel comanda nu va putea fi finalizatÄƒ.
        </div>

        <button type="submit" class="package-btn" style="width: 100%; padding: 16px; font-size: 16px;">
          ğŸ›’ AdaugÄƒ Ã®n CoÈ™ â€” {{ product.selected_or_first_available_variant.price | money }}
        </button>
      </div>
    </form>
    {% else %}
    <form action="/cart/add" method="post">
      <input type="hidden" name="id" value="{{ product.variants.first.id }}">
      <div style="max-width: 500px; margin: 40px auto;">
        <div class="form-group">
          <label for="ig-link">Link Cont sau Postare Instagram:</label>
          <input type="text" id="ig-link" name="properties[Link Instagram]" placeholder="https://instagram.com/username" required class="form-input">
        </div>

        <div class="form-disclaimer">
          âš ï¸ AsigurÄƒ-te cÄƒ profilul este <strong>public</strong>! Altfel comanda nu va putea fi finalizatÄƒ.
        </div>

        <button type="submit" class="package-btn" style="width: 100%; padding: 16px; font-size: 16px;">
          ğŸ›’ AdaugÄƒ Ã®n CoÈ™ â€” {{ product.price | money }}
        </button>
      </div>
    </form>
    {% endif %}
  </div>
</div>

<!-- Popup pentru Link Profil/Postare -->
<div id="profile-link-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
  <div style="background:white; padding:30px; border-radius:8px; max-width:500px; width:90%; box-shadow:0 4px 6px rgba(0,0,0,0.1);">
    <h2 style="margin-top:0;">IntroduceÈ›i linkul profilului sau postÄƒrii</h2>
    <p style="color:#666; font-size:14px;">VÄƒ rugÄƒm sÄƒ introduceÈ›i linkul unde doriÈ›i serviciul (Instagram, TikTok, etc.)</p>
    
    <input 
      type="url" 
      id="profile-link-input" 
      placeholder="https://instagram.com/..." 
      style="width:100%; padding:12px; border:1px solid #ddd; border-radius:4px; font-size:16px; margin:15px 0;"
      required
    />
    <p id="link-error" style="color:red; font-size:14px; display:none;">VÄƒ rugÄƒm sÄƒ introduceÈ›i un URL valid</p>
    
    <div style="display:flex; gap:10px; margin-top:20px;">
      <button 
        id="cancel-modal" 
        style="flex:1; padding:12px; background:#f0f0f0; border:none; border-radius:4px; cursor:pointer; font-size:16px;"
      >
        AnuleazÄƒ
      </button>
      <button 
        id="continue-checkout" 
        style="flex:1; padding:12px; background:#5c6ac4; color:white; border:none; border-radius:4px; cursor:pointer; font-size:16px;"
        disabled
      >
        ContinuÄƒ cÄƒtre checkout
      </button>
    </div>
  </div>
</div>


<script>
  // Update button price on variant change
  const variantSelect = document.getElementById('variant-select');
  if (variantSelect) {
    const productJson = {{ product.variants | json }};
    variantSelect.addEventListener('change', function() {
      const selectedVariant = productJson.find(v => v.id == this.value);
      if (selectedVariant) {
        const btn = document.querySelector('#product-form button[type="submit"]');
        const priceFormatted = (selectedVariant.price / 100).toFixed(2).replace('.', ',') + ' RON';
        btn.innerHTML = 'ğŸ›’ AdaugÄƒ Ã®n CoÈ™ â€” ' + priceFormatted;
      }
    });
  }
</script>
