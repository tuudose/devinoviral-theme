<div class="section" style="padding-top: 120px;">
  <div class="packages-container">
    <div class="section-header">
      <h1>{{ product.title }}</h1>
      <p>{{ product.description }}</p>
    </div>

    {% if product.variants.size > 1 %}
    <form action="/cart/add" method="post" id="product-form">
      <div style="max-width: 500px; margin: 40px auto;">
        <div class="form-group">
          <label for="variant-select">Alege pachetul:</label>
          <select name="id" id="variant-select" class="form-select">
            {% for variant in product.variants %}
              <option value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}selected{% endif %}>
                {{ variant.title }} â€” {{ variant.price | money }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="ig-link">Link Cont sau Postare Instagram:</label>
          <input type="text" id="ig-link" name="properties[Link Instagram]" placeholder="https://instagram.com/username" required class="form-input">
        </div>

        <div class="form-disclaimer">
          âš ï¸ AsigurÄƒ-te cÄƒ profilul este <strong>public</strong>! Altfel comanda nu va putea fi finalizatÄƒ.
        </div>

        <button type="submit" class="package-btn" style="width: 100%; padding: 16px; font-size: 16px;">
          ğŸ›’ AdaugÄƒ Ã®n CoÈ™ â€” {{ product.selected_or_first_available_variant.price | money }}
        </button>
      </div>
    </form>
    {% else %}
    <form action="/cart/add" method="post">
      <input type="hidden" name="id" value="{{ product.variants.first.id }}">
      <div style="max-width: 500px; margin: 40px auto;">
        <div class="form-group">
          <label for="ig-link">Link Cont sau Postare Instagram:</label>
          <input type="text" id="ig-link" name="properties[Link Instagram]" placeholder="https://instagram.com/username" required class="form-input">
        </div>

        <div class="form-disclaimer">
          âš ï¸ AsigurÄƒ-te cÄƒ profilul este <strong>public</strong>! Altfel comanda nu va putea fi finalizatÄƒ.
        </div>

        <button type="submit" class="package-btn" style="width: 100%; padding: 16px; font-size: 16px;">
          ğŸ›’ AdaugÄƒ Ã®n CoÈ™ â€” {{ product.price | money }}
        </button>
      </div>
    </form>
    {% endif %}
  </div>
</div>

<script>
  // Update button price on variant change
  const variantSelect = document.getElementById('variant-select');
  if (variantSelect) {
    const productJson = {{ product.variants | json }};
    variantSelect.addEventListener('change', function() {
      const selectedVariant = productJson.find(v => v.id == this.value);
      if (selectedVariant) {
        const btn = document.querySelector('#product-form button[type="submit"]');
        const priceFormatted = (selectedVariant.price / 100).toFixed(2).replace('.', ',') + ' RON';
        btn.innerHTML = 'ğŸ›’ AdaugÄƒ Ã®n CoÈ™ â€” ' + priceFormatted;
      }
    });
  }
</script>
